<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Step1</title>
<script type="text/javascript"
        src="/static/js/jquery-1.6.3.min.js"></script>
<script type="text/javascript">
$(function() {
            if ($("#id_mark").val() == "") {
                $("#id_model").html('');
                $("#id_model").attr("disabled", true);
                $("#id_model_year").html('');
                $("#id_model_year").attr("disabled", true);
                $("#id_power").html('');
                $("#id_power").attr("disabled", true);
                $("#id_price").val('');
                $("#id_price").attr("disabled", true);
            }
            else {
                if ($("#id_model").val() == "") {
                    $("#id_model_year").html('');
                    $("#id_model_year").attr("disabled", true);
                    $("#id_power").html('');
                    $("#id_power").attr("disabled", true);
                    $("#id_price").val('');
                    $("#id_price").attr("disabled", true);
                }
                else {
                    if ($("#id_model_year").val() == "") {
                        $("#id_power").html('');
                        $("#id_power").attr("disabled", true);
                        $("#id_price").val('');
                        $("#id_price").attr("disabled", true);
                    }
                    else {
                        if ($("#id_power").val() == "") {
                            $("#id_price").val('');
                            $("#id_price").attr("disabled", true);
                        }
                        else
                            $.ajax(
                                    {
                                        url:"{% url get_price %}",
                                        data:{power:$("#id_power").val()},
                                        dataType:"text",
                                        success:function(data) {
                                            if (data == "") {
                                                $("#stoim").html("");
                                                $("#id_price").attr("disabled", true);
                                            }
                                            else {
                                                $("#stoim").html("Стоимость должна быть " + data);
                                                $("#id_price").removeAttr("disabled");
                                            }
                                        }
                                    }
                            );
                    }
                }
            }
            if ($("#id_unlimited_drivers").is(':checked')) {
                $("#extrasect").hide();
                $("#vod1age").hide();
                $("#vod1exp").hide();
                $("#vod2age").hide();
                $("#vod2exp").hide();
                $("#vod3age").hide();
                $("#vod3exp").hide();
            }
            else {
                if ($("#id_age2").val() == "") {
                    if ($("#id_age1").val() == "") {
                        $("#vod2age").hide();
                        $("#vod2exp").hide();
                        $("#vod3age").hide();
                        $("#vod3exp").hide();
                    }
                    else {
                        $("#vod3age").hide();
                        $("#vod3exp").hide();
                    }
                }
                else {
                    if ($("#id_age3").val() == "") {
                        if ($("#id_age2").val() == "") {
                            $("#vod3age").hide();
                            $("#vod3exp").hide();
                        }
                    }
                }
            }
            // Mark.
            $("#id_mark").change(function() {
                $("#id_model").html('');
                $("#id_model_year").html('');
                $("#id_model_year").attr("disabled", true);
                $("#id_power").html('');
                $("#id_power").attr("disabled", true);
                $("#id_price").val('');
                $("#id_price").attr("disabled", true);
                if ($("#id_mark").val() == "")
                    $("#id_model").attr("disabled", true);
                else {
                    $.ajax(
                            {
                                url:"{% url get_models %}",
                                data:{mark:$("#id_mark").val() },
                                dataType:"json",
                                success:function(data) {
                                    var options = '';
                                    options += '<option value="">' + '--------' + '</option>';
                                    $.each(data, function(index, value) {
                                        options += '<option value="' + index + '">' + value + '</option>';
                                    });
                                    $("#id_model").html(options);
                                    $("#id_model").removeAttr("disabled");

                                }
                            }
                    );
                }
            });
            // Model.
            $("#id_model").change(function() {
                $("#id_model_year").html('');
                $("#id_power").html('');
                $("#id_power").attr("disabled", true);
                $("#id_price").val('');
                $("#id_price").attr("disabled", true);
                if ($("#id_model").val() == "") {
                    $("#id_model_year").attr("disabled", true);
                }
                else {
                    $.ajax(
                            {
                                url:"{% url get_years %}",
                                data:{model:$("#id_model").val() },
                                dataType:"json",
                                success:function(data) {
                                    var options = '';
                                    options += '<option value="">' + '--------' + '</option>';
                                    $.each(data, function(index, value) {
                                        options += '<option value="' + index + '">' + value + '</option>';
                                    });
                                    $("#id_model_year").html(options);
                                    $("#id_model_year").removeAttr("disabled");

                                }
                            }
                    );
                }
            });
            // Model year.
            $("#id_model_year").change(function() {
                $("#id_power").html('');
                $("#id_price").val('');
                $("#id_price").attr("disabled", true);
                if ($("#id_model_year").val() == "") {
                    $("#id_power").attr("disabled", true);
                }
                else {
                    $.ajax(
                            {
                                url:"{% url get_powers %}",
                                data:{model:$("#id_model").val(), year:$("#id_model_year").val()},
                                dataType:"json",
                                success:function(data) {
                                    var options = '';
                                    options += '<option value="">' + '--------' + '</option>';
                                    $.each(data, function(index, value) {
                                        options += '<option value="' + index + '">' + value + '</option>';
                                    });
                                    $("#id_power").html(options);
                                    $("#id_power").removeAttr("disabled");

                                }
                            }
                    );
                }


            });
            // Power.
            $("#id_power").change(function() {
                $("#id_price").val('');
                if ($("#id_power").val() == "") {
                    $("#stoim").html("");
                    $("#id_price").attr("disabled", true);
                }
                else
                    $.ajax(
                            {
                                url:"{% url get_price %}",
                                data:{power:$("#id_power").val()},
                                dataType:"text",
                                success:function(data) {
                                    if (data == "") {
                                        $("#stoim").html("");
                                        $("#id_price").attr("disabled", true);
                                    }
                                    else {
                                        $("#stoim").html("Стоимость должна быть " + data);
                                        $("#id_price").removeAttr("disabled");
                                    }
                                }
                            }
                    );
            });
            // Unlimited drivers.
            $("#id_unlimited_drivers").change(function() {
                if ($("#id_unlimited_drivers").is(':checked')) {
                    $("#id_age1").val('');
                    $("#id_experience_driving1").val('');
                    $("#id_age2").val('');
                    $("#id_experience_driving2").val('');
                    $("#id_age3").val('');
                    $("#id_experience_driving3").val('');
                    $("#extrasect").hide();
                    $("#vod1age").hide();
                    $("#vod1exp").hide();
                    $("#vod2age").hide();
                    $("#vod2exp").hide();
                    $("#vod3age").hide();
                    $("#vod3exp").hide();
                }
                else {
                    $("#extrasect").show();
                    $("#vod1age").show();
                    $("#vod1exp").show();
                }
            });
            //
            $("#id_age1").change(function() {
                if ($("#id_age1").val() != "" && $("#id_experience_driving1").val() != "") {
                    $("#vod2age").show();
                    $("#vod2exp").show();
                }
                else {
                    $("#id_age2").val('');
                    $("#id_experience_driving2").val('');
                    $("#id_age3").val('');
                    $("#id_experience_driving3").val('');
                    $("#vod2age").hide();
                    $("#vod2exp").hide();
                    $("#vod3age").hide();
                    $("#vod3exp").hide();
                }
            });
            $("#id_experience_driving1").change(function() {
                if ($("#id_age1").val() != "" && $("#id_experience_driving1").val() != "") {
                    $("#vod2age").show();
                    $("#vod2exp").show();
                }
                else {
                    $("#id_age2").val('');
                    $("#id_experience_driving2").val('');
                    $("#id_age3").val('');
                    $("#id_experience_driving3").val('');
                    $("#vod2age").hide();
                    $("#vod2exp").hide();
                    $("#vod3age").hide();
                    $("#vod3exp").hide();
                }
            });
            $("#id_age2").change(function() {
                if ($("#id_age2").val() != "" && $("#id_experience_driving2").val() != "") {
                    $("#vod3age").show();
                    $("#vod3exp").show();
                }
                else {
                    $("#id_age3").val('');
                    $("#id_experience_driving3").val('');
                    $("#vod3age").hide();
                    $("#vod3exp").hide();
                }
            });
            $("#id_experience_driving2").change(function() {
                if ($("#id_age2").val() != "" && $("#id_experience_driving2").val() != "") {
                    $("#vod3age").show();
                    $("#vod3exp").show();
                }
                else {
                    $("#id_age3").val('');
                    $("#id_experience_driving3").val('');
                    $("#vod3age").hide();
                    $("#vod3exp").hide();
                }
            });
        }
);
</script>
</head>
<body>
<b id="stoim"></b><br/>

<form action="" method="post">
    {% csrf_token %}
    {% if s1_form.non_field_errors %}
        <div>
            <h2>Ошибки заполнения формы:</h2>
            {{ s1_form.non_field_errors }}
        </div>
    {% endif %}
    <table>
        <tr>
            <td><b>Обязательные данные:</b></td>
        </tr>
        <tr>
            <td>{{ s1_form.mark.label }}</td>
            <td>
                {{ s1_form.mark }}
                {{ s1_form.mark.errors }}
            </td>
        </tr>
        <tr>
            <td>{{ s1_form.model.label }}</td>
            <td>
                {{ s1_form.model }}
                {{ s1_form.model.errors }}
            </td>
        </tr>
        <tr>
            <td>{{ s1_form.model_year.label }}</td>
            <td>
                {{ s1_form.model_year }}
                {{ s1_form.model_year.errors }}
            </td>
        </tr>
        <tr>
            <td>{{ s1_form.power.label }}</td>
            <td>
                {{ s1_form.power }}
                {{ s1_form.power.errors }}
            </td>
        </tr>
        <tr>
            <td>{{ s1_form.price.label }}</td>
            <td>
                {{ s1_form.price }}
                {{ s1_form.price.errors }}
            </td>
        </tr>
        <tr>
            <td>{{ s1_form.wheel.label }}</td>
            <td>
                {{ s1_form.wheel }}
                {{ s1_form.wheel.errors }}
            </td>
        </tr>
        <tr>
            <td>{{ s1_form.city.label }}</td>
            <td>
                {{ s1_form.city }}
                {{ s1_form.city.errors }}
            </td>
        </tr>
        <tr>
            <td>{{ s1_form.credit.label }}</td>
            <td>
                {{ s1_form.credit }}
                {{ s1_form.credit.errors }}
            </td>
        </tr>
        <tr>
            <td>{{ s1_form.age.label }}</td>
            <td>
                {{ s1_form.age }}
                {{ s1_form.age.errors }}
            </td>
        </tr>
        <tr>
            <td>{{ s1_form.experience_driving.label }}</td>
            <td>
                {{ s1_form.experience_driving }}
                {{ s1_form.experience_driving.errors }}
            </td>
        </tr>
        <tr>
            <td>{{ s1_form.unlimited_drivers.label }}</td>
            <td>
                {{ s1_form.unlimited_drivers }}
                {{ s1_form.unlimited_drivers.errors }}
            </td>
        </tr>
        <tr id="extrasect">
            <td><b>Доп. водители (опционально):</b></td>
        </tr>
        <tr id="vod1age">
            <td>{{ s1_form.age1.label }}</td>
            <td>
                {{ s1_form.age1 }}
                {{ s1_form.age1.errors }}
            </td>
        </tr>
        <tr id="vod1exp">
            <td>{{ s1_form.experience_driving1.label }}</td>
            <td>
                {{ s1_form.experience_driving1 }}
                {{ s1_form.experience_driving1.errors }}
            </td>
        </tr>
        <tr id="vod2age">
            <td>{{ s1_form.age2.label }}</td>
            <td>
                {{ s1_form.age2 }}
                {{ s1_form.age2.errors }}
            </td>
        </tr>
        <tr id="vod2exp">
            <td>{{ s1_form.experience_driving2.label }}</td>
            <td>
                {{ s1_form.experience_driving2 }}
                {{ s1_form.experience_driving2.errors }}
            </td>
        </tr>
        <tr id="vod3age">
            <td>{{ s1_form.age3.label }}</td>
            <td>
                {{ s1_form.age3 }}
                {{ s1_form.age3.errors }}
            </td>
        </tr>
        <tr id="vod3exp">
            <td>{{ s1_form.experience_driving3.label }}</td>
            <td>
                {{ s1_form.experience_driving3 }}
                {{ s1_form.experience_driving3.errors }}
            </td>
        </tr>
    </table>
    <input type="submit" value="Рассчитать"/>
</form>
<br/>
<a href="{% url cleansession %}">очистить сессию (для тестов)</a>
</body>
</html>
